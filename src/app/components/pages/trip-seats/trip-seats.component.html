<!-- <div class="max-w-6xl mx-auto p-6 bg-white shadow rounded mt-10">
  <h2 class="text-2xl font-bold text-blue-700 mb-6">🚌 Selección de asientos para el viaje</h2>

  <div *ngFor="let level of levels" class="mb-12">
    <h3 class="text-xl font-semibold text-gray-800 mb-4">🧱 Nivel {{ level.nivel }}</h3>

    <div class="bg-gray-200 rounded-lg p-4 overflow-x-auto border relative" style="min-height: 240px">
      <div class="absolute top-0 left-1/2 -translate-x-1/2 w-3/4 h-3 bg-gray-400 rounded-b-lg"></div>
      <div class="grid gap-2 relative"
           [style.gridTemplateColumns]="'repeat(' + level.maxX + ', 40px)'"
           [style.gridTemplateRows]="'repeat(' + level.maxY + ', 40px)'"
           style="position: relative; width: max-content;">
        
        <div
          *ngFor="let asiento of level.asientos"
          class="w-10 h-10 flex items-center justify-center text-xs font-semibold rounded cursor-pointer shadow transition-all duration-200 hover:scale-110"
          [ngClass]="getSeatClasses(asiento)"
          (click)="toggleSeat(asiento.asiento_viaje_id)"
          [title]="asiento.etiqueta"
          [style.gridColumn]="asiento.x + 1"
          [style.gridRow]="asiento.y + 1"
        >
          {{ asiento.etiqueta }}
        </div>
      </div>
    </div>
  </div>

  <div class="mt-8">
    <h4 class="font-semibold mb-2">🎟️ Asientos seleccionados:</h4>
    <div *ngIf="selectedSeats.length === 0" class="text-gray-500 italic">Ninguno</div>
    <ul class="list-disc ml-6">
      <li *ngFor="let s of selectedSeats">{{ s }}</li>
    </ul>
  </div>
   <div class="mt-8 border-t pt-4 flex gap-6 text-sm text-gray-700">
    <div class="flex items-center gap-2">
      <div class="w-5 h-5 seat-shape bg-purple-600"></div> Cama
    </div>
    <div class="flex items-center gap-2">
      <div class="w-5 h-5 seat-shape bg-blue-600"></div> Semi-cama
    </div>
    <div class="flex items-center gap-2">
      <div class="w-5 h-5 seat-shape bg-green-500 ring-2 ring-green-300"></div> Seleccionado
    </div>
  </div>
</div>

 -->



<!-- second style -->
<!--  
<div class="max-w-6xl mx-auto p-6 bg-white shadow rounded mt-10">
  <h2 class="text-2xl font-bold text-blue-700 mb-6">🚌 Selección de asientos para el viaje</h2>

  <div *ngFor="let level of levels" class="mb-12">
    <h3 class="text-xl font-semibold text-gray-800 mb-4">🧱 Nivel {{ level.nivel }}</h3>

    <div
      class="bg-gradient-to-r from-gray-300 to-gray-100 p-6 rounded-xl border border-gray-400 shadow-inner relative overflow-x-auto"
      style="min-height: 240px"
    >
      <div class="absolute top-0 left-1/2 -translate-x-1/2 w-3/4 h-3 bg-gray-400 rounded-b-lg"></div>

      <div
        class="grid gap-2 relative"
        [style.gridTemplateColumns]="'repeat(' + level.maxX + ', 40px)'"
        [style.gridTemplateRows]="'repeat(' + level.maxY + ', 40px)'"
        style="position: relative; width: max-content;"
      >
        <div
          *ngFor="let asiento of level.asientos"
          class="w-10 h-10 flex items-center justify-center text-[10px] font-bold text-white cursor-pointer shadow seat-shape transition-all duration-200 hover:scale-105"
          [ngClass]="getSeatClasses(asiento)"
          (click)="toggleSeat(asiento.asiento_viaje_id)"
          [title]="asiento.etiqueta + ' - Bs. ' + asiento.precio"
          [style.gridColumn]="asiento.x + 1"
          [style.gridRow]="asiento.y + 1"
        >
          {{ asiento.etiqueta }}
        </div>
      </div>
    </div>
  </div>

  <div class="mt-6">
    <h4 class="font-semibold mb-2">🎟️ Asientos seleccionados:</h4>
    <div *ngIf="selectedSeats.length === 0" class="text-gray-500 italic">Ninguno</div>
    <ul class="list-disc ml-6">
      <li *ngFor="let s of selectedSeats">{{ s }}</li>
    </ul>
  </div>

  <div class="mt-8 border-t pt-4 flex gap-6 text-sm text-gray-700">
    <div class="flex items-center gap-2">
      <div class="w-5 h-5 seat-shape bg-purple-600"></div> Cama
    </div>
    <div class="flex items-center gap-2">
      <div class="w-5 h-5 seat-shape bg-blue-600"></div> Semi-cama
    </div>
    <div class="flex items-center gap-2">
      <div class="w-5 h-5 seat-shape bg-green-500 ring-2 ring-green-300"></div> Seleccionado
    </div>
  </div>
</div> -->


<!-- <div class="max-w-6xl mx-auto p-6 bg-white shadow rounded mt-10">
  <h2 class="text-2xl font-bold text-blue-700 mb-6">🚌 Selección de asientos para el viaje</h2>

  <div class="flex justify-center gap-12">
    <div *ngFor="let level of levels" class="flex flex-col items-center">
      <h3 class="text-xl font-semibold text-gray-800 mb-4">🧱 Piso {{ level.nivel }}</h3>

      <div class="bg-gray-200 rounded-lg p-4 overflow-auto border"
           style="min-height: 320px; min-width: 200px;">
        <div class="grid gap-2"
             [style.gridTemplateColumns]="'repeat(' + level.maxX + ', 40px)'"
             [style.gridTemplateRows]="'repeat(' + level.maxY + ', 40px)'"
             style="width: max-content;">
          
          <div
            *ngFor="let asiento of level.asientos"
            class="w-10 h-10 flex items-center justify-center text-xs font-semibold rounded cursor-pointer shadow transition-all duration-200 hover:scale-110"
            [ngClass]="getSeatClasses(asiento)"
            (click)="toggleSeat(asiento.asiento_viaje_id)"
            [title]="asiento.etiqueta"
            [style.gridColumn]="asiento.x + 1"
            [style.gridRow]="asiento.y + 1"
          >
            {{ asiento.etiqueta }}
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="mt-8">
    <h4 class="font-semibold mb-2">🎟️ Asientos seleccionados:</h4>
    <div *ngIf="selectedSeats.length === 0" class="text-gray-500 italic">Ninguno</div>
    <ul class="list-disc ml-6">
      <li *ngFor="let s of selectedSeats">{{ s }}</li>
    </ul>
  </div>

  <div class="mt-8 border-t pt-4 flex gap-6 text-sm text-gray-700 justify-center">
    <div class="flex items-center gap-2">
      <div class="w-5 h-5 seat-shape bg-purple-600"></div> Cama
    </div>
    <div class="flex items-center gap-2">
      <div class="w-5 h-5 seat-shape bg-blue-600"></div> Semi-cama
    </div>
    <div class="flex items-center gap-2">
      <div class="w-5 h-5 seat-shape bg-green-500 ring-2 ring-green-300"></div> Seleccionado
    </div>
  </div>
</div> -->

<div class="max-w-6xl mx-auto p-6 bg-white shadow rounded mt-10">
  <h2 class="text-2xl font-bold text-blue-700 mb-6">🚌 Selección de asientos para el viaje</h2>

  <div class="flex flex-col md:flex-row justify-center gap-12">
    <div *ngFor="let level of levels" class="flex flex-col items-center">
      <h3 class="text-xl font-semibold text-gray-800 mb-4">🧱 Piso {{ level.nivel }}</h3>

      <div class="bg-gray-200 rounded-lg p-4 overflow-auto border shadow-inner"
           style="min-height: 320px; min-width: 220px;">
        <div class="grid gap-2 relative"
             [style.gridTemplateColumns]="'repeat(' + level.maxX + ', 40px)'"
             [style.gridTemplateRows]="'repeat(' + level.maxY + ', 40px)'"
             style="width: max-content;">

          <div
            *ngFor="let asiento of level.asientos"
            class="w-10 h-10 flex items-center justify-center text-xs font-semibold cursor-pointer transition-all duration-200 transform hover:scale-110 active:scale-95"
            [ngClass]="getSeatClasses(asiento)"
            (click)="toggleSeat(asiento.asiento_viaje_id)"
            [title]="'Asiento: ' + asiento.etiqueta + ' | ' + asiento.tipo_asiento + ' | Bs. ' + asiento.precio"
            [attr.aria-label]="asiento.etiqueta"
            tabindex="0"
            [style.gridColumn]="asiento.x + 1"
            [style.gridRow]="asiento.y + 1"
          >
          <ng-container *ngIf="asiento.ocupado; else seatLabel">
            🔒
          </ng-container>
          <ng-template #seatLabel>
            {{ asiento.etiqueta }}
          </ng-template>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- <div class="mt-8">
    <h4 class="font-semibold mb-2">🎟️ Asientos seleccionados:</h4>
    <div *ngIf="selectedSeats.length === 0" class="text-gray-500 italic">Ninguno</div>
    <ul class="list-disc ml-6">
      <li *ngFor="let s of selectedSeats">{{ s }}</li>
    </ul>
  </div> -->
  <div class="mt-8">
    <h4 class="font-semibold mb-2">🎟️ Asientos seleccionados:</h4>
    <div *ngIf="selectedSeats.length === 0" class="text-gray-500 italic">Ninguno</div>
    <ul class="list-disc ml-6 mb-4">
      <li *ngFor="let s of selectedSeats">{{ s }}</li>
    </ul>
    
    <div class="text-lg font-bold mb-4">Total: Bs. {{ getTotal() }}</div>
    
    <button 
      (click)="openPurchaseModal(showPurchaseModal)"
      [disabled]="selectedSeats.length === 0"
      class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded disabled:bg-gray-400 disabled:cursor-not-allowed"
    >
      Confirmar Asientos
    </button>
  </div>

  <div class="mt-8 border-t pt-4 flex flex-wrap gap-4 text-sm text-gray-700 justify-center">
    <div class="flex items-center gap-2">
      <div class="w-5 h-5 bg-purple-600 rounded-full shadow"></div> Cama
    </div>
    <div class="flex items-center gap-2">
      <div class="w-5 h-5 bg-blue-600 rounded shadow"></div> Semi-cama
    </div>
    <div class="flex items-center gap-2">
      <div class="w-5 h-5 bg-green-500 ring-2 ring-green-300 rounded shadow"></div> Seleccionado
    </div>
    <div class="flex items-center gap-2">
      <div class="w-5 h-5 bg-gray-400 opacity-60 cursor-not-allowed rounded shadow"></div> Ocupado
    </div>
  </div>
</div>

<ng-template #purchaseModal let-modal>
  <div class="modal-header">
    <h4 class="modal-title">Confirmar Compra</h4>
    <button type="button" class="close" aria-label="Close" (click)="modal.dismiss()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  
  <div class="modal-body">
    <div *ngIf="purchaseSuccess" class="alert alert-success">
      ¡Compra realizada con éxito!
    </div>
    
    <div *ngIf="purchaseError" class="alert alert-danger">
      {{ purchaseError }}
    </div>
    
    <div *ngIf="!purchaseSuccess">
      <h5 class="font-bold mb-3">Resumen de Compra</h5>
      <ul class="list-disc ml-5 mb-4">
        <li *ngFor="let s of selectedSeats">{{ s.etiqueta }} - Bs. {{ s.precio }}</li>
      </ul>
      <p class="font-bold text-lg mb-4">Total a Pagar: Bs. {{ getTotal() }}</p>
      
      <h5 class="font-bold mb-3">Datos del Pasajero</h5>
      <form>
        <div class="form-group">
          <label for="nombre">Nombre Completo</label>
          <input type="text" class="form-control" id="nombre" 
                 [(ngModel)]="passengerData.nombre" name="nombre" required>
        </div>
        <div class="form-group">
          <label for="ci">Cédula de Identidad</label>
          <input type="text" class="form-control" id="ci" 
                 [(ngModel)]="passengerData.ci" name="ci" required>
        </div>
        <div class="form-group">
          <label for="fechaNacimiento">Fecha de Nacimiento</label>
          <input type="date" class="form-control" id="fechaNacimiento" 
                 [(ngModel)]="passengerData.fechaNacimiento" name="fechaNacimiento" required>
        </div>
      </form>
    </div>
  </div>
  
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="modal.dismiss()">Cancelar</button>
    <button *ngIf="!purchaseSuccess" type="button" class="btn btn-primary" 
            (click)="confirmPurchase()" [disabled]="isLoading">
      <span *ngIf="isLoading" class="spinner-border spinner-border-sm"></span>
      {{ isLoading ? 'Procesando...' : 'Confirmar Compra' }}
    </button>
    <button *ngIf="purchaseSuccess" type="button" class="btn btn-success" 
            (click)="modal.close()">
      Aceptar
    </button>
  </div>
</ng-template>
