

<div class="max-w-6xl mx-auto p-6 bg-white shadow rounded mt-10">
  <h2 class="text-2xl font-bold text-blue-700 mb-6">üöå Selecci√≥n de asientos para el viaje</h2>

  <div class="flex flex-col md:flex-row justify-center gap-12">
    <div *ngFor="let level of levels" class="flex flex-col items-center">
      <h3 class="text-xl font-semibold text-gray-800 mb-4">üß± Piso {{ level.nivel }}</h3>

      <div class="bg-gray-200 rounded-lg p-4 overflow-auto border shadow-inner"
           style="min-height: 320px; min-width: 220px;">
        <div class="grid gap-2 relative"
             [style.gridTemplateColumns]="'repeat(' + level.maxX + ', 40px)'"
             [style.gridTemplateRows]="'repeat(' + level.maxY + ', 40px)'"
             style="width: max-content;">

          <div
            *ngFor="let asiento of level.asientos"
            class="w-10 h-10 flex items-center justify-center text-xs font-semibold cursor-pointer transition-all duration-200 transform hover:scale-110 active:scale-95"
            [ngClass]="getSeatClasses(asiento)"
            (click)="toggleSeat(asiento)"
            [title]="'Asiento: ' + asiento.etiqueta + ' | ' + asiento.tipo_asiento + ' | Bs. ' + asiento.precio"
            [attr.aria-label]="asiento.etiqueta"
            tabindex="0"
            [style.gridColumn]="asiento.x + 1"
            [style.gridRow]="asiento.y + 1"
          >
          <ng-container *ngIf="asiento.ocupado; else seatLabel">
            üîí
          </ng-container>
          <ng-template #seatLabel>
            {{ asiento.etiqueta }}
          </ng-template>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="mt-8">
    <h4 class="font-semibold mb-2">üéüÔ∏è Asientos seleccionados:</h4>
    <div *ngIf="selectedSeats.length === 0" class="text-gray-500 italic">Ninguno</div>
    <ul class="list-disc ml-6 mb-4">
      <li *ngFor="let seat of selectedSeats">{{ seat.etiqueta }} - {{ seat.tipo_asiento }} - Bs. {{ seat.precio }}</li>
    </ul>
    
    <div class="text-lg font-bold mb-4">Total: Bs. {{ getTotal() }}</div>
    
    <button 
      (click)="openPurchaseModal()"
      [disabled]="selectedSeats.length === 0"
      class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded disabled:bg-gray-400 disabled:cursor-not-allowed"
    >
      Confirmar Asientos
    </button>
  </div>

  <div class="mt-8 border-t pt-4 flex flex-wrap gap-4 text-sm text-gray-700 justify-center">
    <div class="flex items-center gap-2">
      <div class="w-5 h-5 bg-purple-600 rounded-full shadow"></div> Cama
    </div>
    <div class="flex items-center gap-2">
      <div class="w-5 h-5 bg-blue-600 rounded shadow"></div> Semi-cama
    </div>
    <div class="flex items-center gap-2">
      <div class="w-5 h-5 bg-green-500 ring-2 ring-green-300 rounded shadow"></div> Seleccionado
    </div>
    <div class="flex items-center gap-2">
      <div class="w-5 h-5 bg-gray-400 opacity-60 cursor-not-allowed rounded shadow"></div> Ocupado
    </div>
  </div>
</div>


<div *ngIf="showPurchaseModal" class="fixed inset-0 bg-gray-900/50 flex items-center justify-center p-4 z-50">
  <div class="bg-white rounded-xl shadow-lg w-full max-w-2xl">
    <div class="flex justify-between items-center p-6 border-b">
      <h3 class="text-2xl font-bold text-blue-700">Confirmar Compra</h3>
      <button 
        (click)="closeModal()"
        class="text-gray-500 hover:text-gray-700 focus:outline-none"
      >
        <span class="text-2xl">&times;</span>
      </button>
    </div>
    
    <div class="p-6">
      <div *ngIf="purchaseSuccess" class="mb-6 p-4 bg-green-100 text-green-800 rounded-lg">
        <div class="flex items-center">
          <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
          </svg>
          <span class="font-medium">¬°Compra realizada con √©xito!</span>
        </div>
      </div>
      
      <div *ngIf="purchaseError" class="mb-6 p-4 bg-red-100 text-red-800 rounded-lg">
        <div class="flex items-center">
          <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
          </svg>
          <span class="font-medium">{{ purchaseError }}</span>
        </div>
      </div>
      

      <div *ngIf="!purchaseSuccess">

        <div class="mb-6">
          <h4 class="text-xl font-semibold text-gray-800 mb-3">Resumen de Compra</h4>
          <ul class="space-y-2 mb-4">
            <li *ngFor="let seat of selectedSeats" class="flex justify-between">
              <span>Asiento {{ seat.etiqueta }} ({{ seat.tipo_asiento }})</span>
              <span class="font-medium">Bs. {{ seat.precio }}</span>
            </li>
          </ul>
          <div class="flex justify-between border-t pt-3">
            <span class="font-bold text-lg">Total a pagar:</span>
            <span class="font-bold text-lg">Bs. {{ getTotal() }}</span>
          </div>
        </div>
        

        <div>
          <h4 class="text-xl font-semibold text-gray-800 mb-3">Datos del Pasajero</h4>
          <form class="space-y-4">
            <div>
              <label for="nombre" class="block text-sm font-medium text-gray-700 mb-1">Nombre Completo</label>
              <input 
                type="text" 
                id="nombre" 
                [(ngModel)]="passengerData.nombre" 
                name="nombre"
                required
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"
              >
            </div>
            
            <div>
              <label for="ci" class="block text-sm font-medium text-gray-700 mb-1">C√©dula de Identidad</label>
              <input 
                type="text" 
                id="ci" 
                [(ngModel)]="passengerData.ci" 
                name="ci"
                required
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"
              >
            </div>
            
            <div>
              <label for="fechaNacimiento" class="block text-sm font-medium text-gray-700 mb-1">Fecha de Nacimiento</label>
              <input 
                type="date" 
                id="fechaNacimiento" 
                [(ngModel)]="passengerData.fechaNacimiento" 
                name="fechaNacimiento"
                required
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"
              >
            </div>
          </form>
        </div>
      </div>
    </div>
    

    <div class="flex justify-end p-6 border-t space-x-3">
      <button 
        (click)="closeModal()"
        class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
      >
        Cancelar
      </button>
      
      <button 
        *ngIf="!purchaseSuccess"
        (click)="confirmPurchase()" 
        [disabled]="isLoading || !passengerData.nombre || !passengerData.ci || !passengerData.fechaNacimiento"
        class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:bg-blue-400 disabled:cursor-not-allowed"
      >
        <span *ngIf="isLoading" class="inline-block animate-spin mr-2">‚Üª</span>
        {{ isLoading ? 'Procesando...' : 'Confirmar Compra' }}
      </button>
      
      <button 
        *ngIf="purchaseSuccess"
        (click)="closeModal()"
        class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500"
      >
        Aceptar
      </button>
    </div>
  </div>
</div>